<!DOCTYPE html>
<html>
<head>
<title>Attendance Dashboard</title>

<style>
body{
    font-family:Arial;
    background:#f9f9f9;
    padding:30px;
}

h2{ color:#0056b3; }

button{
    padding:12px 25px;
    font-size:16px;
    margin:10px 0;
    background:#28a745;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
}

button:disabled{
    background:#aaa;
    cursor:not-allowed;
}

#status{
    margin-top:20px;
    font-weight:bold;
}
</style>
</head>

<body>

<h2>Welcome</h2>
<p id="user"></p>

<h3>Attendance</h3>

<button id="inBtn" onclick="markIn()">âœ… I am in Office</button><br>

<button id="outBtn" onclick="markOut()">ðŸšª I am Leaving</button>

<p id="status"></p>

<button onclick="logout()">Logout</button>

<script>

// Google Form URL
const FORM_URL =
"https://docs.google.com/forms/d/e/1FAIpQLSf6vzUcheslghKL4nR-a7_GgN3VESLjazzfsaxnmTuEaIY0ow/formResponse";


// Entry IDs
const ENTRY = {
    id: "entry.1859002656",
    name: "entry.339531515",

    date: "entry.1163502489",

    intime: "entry.542167419",
    outtime: "entry.1532127027",

    lat: "entry.1008700991",
    long: "entry.698099376",

    status: "entry.1126631987"
};


// Login Info
const id = localStorage.getItem("userid");
const name = localStorage.getItem("name");

if(!id){
    window.location.href="index.html";
}

document.getElementById("user").innerText =
"ID: " + id + " | Name: " + name;


// Time Control
// REPLACE your Time Control section with this:
if (hour < 12) {
    // MORNING: Only "In" is active
    inBtn.disabled = false;
    outBtn.disabled = true;
} else if (hour >= 12 && hour < 18) {
    // AFTERNOON: Only "Out" is active
    inBtn.disabled = true;
    outBtn.disabled = false;
} else {
    // NIGHT: Everything off
    inBtn.disabled = true;
    outBtn.disabled = true;
}



// Get Date Parts
function getDateParts(){

    const d = new Date();

    return {
        year: d.getFullYear(),
        month: d.getMonth()+1,
        day: d.getDate()
    };
}


// Get Time Parts
function getTimeParts(){

    const d = new Date();

    return {
        hour: d.getHours(),
        minute: d.getMinutes()
    };
}


// Get Location
function getLocation(cb){

    if(!navigator.geolocation){
        cb("","");
        return;
    }

    navigator.geolocation.getCurrentPosition(
        pos=>{
            cb(pos.coords.latitude,pos.coords.longitude);
        },
        ()=>{
            cb("","");
        }
    );
}



// IN
function markIn(){

    const t = getTimeParts();
    const d = getDateParts();

    let status = "Present";

    if(t.hour > 9){
        status = "Late";
    }

    sendData(d,t,null,status);

}



// OUT
function markOut(){

    const t = getTimeParts();
    const d = getDateParts();

    sendData(d,null,t,"Present");

}



// FIXED Send Data function
function sendData(date, inTime, outTime, status) {
    getLocation((lat, long) => {
        const fd = new FormData();

        // Prepare strings (Short Answer format)
        const dateStr = `${date.day}/${date.month}/${date.year}`;
        
        // If time is missing, we send "---" so the Required field isn't empty
        const inStr = inTime ? `${inTime.hour}:${String(inTime.minute).padStart(2,"0")}` : "---";
        const outStr = outTime ? `${outTime.hour}:${String(outTime.minute).padStart(2,"0")}` : "---";

        // Map your verified Entry IDs
        fd.append("entry.1859002656", id);          // ID
        fd.append("entry.339531515", name);        // Name
        fd.append("entry.1163502489", dateStr);     // Date
        fd.append("entry.542167419", inStr);        // InTime
        fd.append("entry.1532127027", outStr);      // OutTime
        fd.append("entry.1008700991", lat || "0");  // Lat
        fd.append("entry.698099376", long || "0");  // Long
        fd.append("entry.1126631987", status);      // Status

        fetch(FORM_URL, {
            method: "POST",
            mode: "no-cors",
            body: fd
        })
        .then(() => {
            document.getElementById("status").innerText = "âœ… Attendance Submitted Successfully!";
            inBtn.disabled = true;
            outBtn.disabled = true;
        })
        .catch((err) => {
            console.error(err);
            alert("Failed to connect to Google Sheets.");
        });
    });
}


// Logout
function logout(){
    localStorage.clear();
    window.location.href="index.html";
}

</script>

</body>
</html>






