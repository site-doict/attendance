<!DOCTYPE html>
<html>
<head>
<title>Attendance Dashboard</title>

<style>
body{
    font-family:Arial;
    background:#f9f9f9;
    padding:30px;
}

h2{ color:#0056b3; }

button{
    padding:12px 25px;
    font-size:16px;
    margin:10px 0;
    background:#28a745;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
}

button:disabled{
    background:#aaa;
    cursor:not-allowed;
}

#status{
    margin-top:20px;
    font-weight:bold;
}
</style>
</head>

<body>

<h2>Welcome</h2>
<p id="user"></p>

<h3>Attendance</h3>

<button id="inBtn" onclick="markIn()">âœ… I am in Office</button>
<br>

<button id="outBtn" onclick="markOut()">ðŸšª I am Leaving</button>

<p id="status"></p>

<button onclick="logout()">Logout</button>

<script>

// Google Form URL
const FORM_URL =
"https://docs.google.com/forms/d/e/1FAIpQLSf6vzUcheslghKL4nR-a7_GgN3VESLjazzfsaxnmTuEaIY0ow/formResponse";

// Entry IDs
const ENTRY = {
    id: "entry.1859002656",
    name: "entry.339531515",
    date: "entry.1163502489",
    intime: "entry.542167419",
    outtime: "entry.1532127027",
    lat: "entry.1008700991",
    long: "entry.698099376",
    status: "entry.1126631987"
};


// Login Info
const id = localStorage.getItem("userid");
const name = localStorage.getItem("name");

if(!id){
    window.location.href="index.html";
}

document.getElementById("user").innerText =
"ID: " + id + " | Name: " + name;


// Time Control
const now = new Date();
const hour = now.getHours();

const inBtn = document.getElementById("inBtn");
const outBtn = document.getElementById("outBtn");


// Button Logic
if(hour < 11){
    outBtn.disabled = true;
}
else if(hour >= 14){
    inBtn.disabled = true;
}
else{
    inBtn.disabled = true;
    outBtn.disabled = true;
}



// Get Current Time HH:MM
function getTime(){

    return new Date().toLocaleTimeString([],{
        hour:"2-digit",
        minute:"2-digit"
    });
}


// Get Date
function getDate(){
    return new Date().toISOString().split("T")[0];
}


// Get Location
function getLocation(cb){

    if(!navigator.geolocation){
        cb("","");
        return;
    }

    navigator.geolocation.getCurrentPosition(
        pos=>{
            cb(pos.coords.latitude,pos.coords.longitude);
        },
        ()=>{
            cb("","");
        }
    );
}



// Submit IN
function markIn(){

    const time = getTime();
    const date = getDate();

    let status = "Present";

    if(time > "09:00"){
        status = "Late";
    }

    sendData(time,"",status);

}



// Submit OUT
function markOut(){

    const time = getTime();

    sendData("",time,"Present");

}



// Send Data
function sendData(inTime,outTime,status){

    getLocation((lat,long)=>{

        const fd = new FormData();

        fd.append(ENTRY.id,id);
        fd.append(ENTRY.name,name);
        fd.append(ENTRY.date,getDate());
        fd.append(ENTRY.intime,inTime);
        fd.append(ENTRY.outtime,outTime);
        fd.append(ENTRY.lat,lat);
        fd.append(ENTRY.long,long);
        fd.append(ENTRY.status,status);


        fetch(FORM_URL,{
            method:"POST",
            mode:"no-cors",
            body:fd
        })
        .then(()=>{
            document.getElementById("status").innerText =
            "âœ… Attendance Submitted";

            inBtn.disabled = true;
            outBtn.disabled = true;
        })
        .catch(()=>{
            alert("Submission Failed");
        });

    });

}



// Logout
function logout(){
    localStorage.clear();
    window.location.href="index.html";
}

</script>

</body>
</html>
