<!DOCTYPE html>
<html>
<head>
<title>Attendance Dashboard</title>

<style>
body{
    font-family:Arial;
    background:#f9f9f9;
    padding:30px;
}
h2{
    color:#0056b3;
}
label{
    display:block;
    margin-top:10px;
}
input[type="text"], input[type="time"]{
    padding:8px;
    width:200px;
    margin-top:4px;
}
button{
    margin-top:20px;
    padding:10px 20px;
    background:#28a745;
    color:white;
    border:none;
    cursor:pointer;
    border-radius:4px;
}
button:hover{
    background:#218838;
}
#status{
    margin-top:20px;
    font-weight:bold;
}
</style>
</head>

<body>

<h2>Welcome</h2>
<p id="user"></p>

<h3>Submit Attendance</h3>

<form id="attendanceForm">
    <label>In Time: <input type="time" id="intime"></label>
    <label>Out Time: <input type="time" id="outtime"></label>
    <input type="hidden" id="lat">
    <input type="hidden" id="lng">
    <button type="button" onclick="submitAttendance()">Submit</button>
</form>

<p id="status"></p>
<button onclick="logout()">Logout</button>

<script>
const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSf6vzUcheslghKL4nR-a7_GgN3VESLjazzfsaxnmTuEaIY0ow/formResponse";

// Get saved login info
const id = localStorage.getItem("userid");
const name = localStorage.getItem("name");

if (!id) {
    window.location.href = "index.html";
}

document.getElementById("user").innerText =
    "ID: " + id + " | Name: " + name;


// Get current time
function getTime() {
    return new Date().toLocaleTimeString([], {
        hour: "2-digit",
        minute: "2-digit"
    });
}


// Get current date (yyyy-mm-dd)
function getDate() {
    return new Date().toISOString().split("T")[0];
}


// Get GPS location
function getLocation(callback) {

    if (!navigator.geolocation) {
        callback("", "");
        return;
    }

    navigator.geolocation.getCurrentPosition(
        pos => {
            callback(
                pos.coords.latitude,
                pos.coords.longitude
            );
        },
        () => {
            callback("", "");
        }
    );
}


// Submit attendance
function submitAttendance() {

    const inTime = document.getElementById("intime").value;
    const outTime = document.getElementById("outtime").value;

    if (!inTime || !outTime) {
        alert("Please select In and Out time");
        return;
    }

    const date = getDate();
    const status = "Present";

    getLocation((lat, long) => {

        const formData = new FormData();

        // Google Form fields
        formData.append("entry.1859002656", id);       // ID
        formData.append("entry.339531515", name);     // Name
        formData.append("entry.1163502489", date);    // Date
        formData.append("entry.542167419", inTime);   // In Time
        formData.append("entry.1532127027", outTime); // Out Time
        formData.append("entry.1008700991", lat);     // Lat
        formData.append("entry.698099376", long);     // Long
        formData.append("entry.1126631987", status);  // Status


        fetch(FORM_URL, {
            method: "POST",
            mode: "no-cors",
            body: formData
        })
        .then(() => {
            alert("Attendance submitted successfully!");
        })
        .catch(() => {
            alert("Submission failed!");
        });

    });

}


// Logout
function logout() {
    localStorage.clear();
    window.location.href = "index.html";
}
</script>


</body>
</html>

