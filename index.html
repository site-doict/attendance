<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Office Attendance</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a1a1a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Office Attendance">
<link rel="apple-touch-icon" href="icon-192.png">

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{ font-family: Arial, sans-serif; background:#f0f2f5; display:flex; justify-content:center; align-items:center; height:100vh; }
.login-box{ background:white; padding:30px; width:300px; border-radius:6px; box-shadow:0 0 10px rgba(0,0,0,.1); }
h2{text-align:center; margin-bottom:20px;}
input{width:100%; padding:10px; margin:10px 0; border:1px solid #ccc; border-radius:4px; box-sizing:border-box;}
button{width:100%; padding:10px; background:#0056b3; color:white; border:none; cursor:pointer; border-radius:4px;}
button:hover{ background:#004099; }
#error{ color:red; text-align:center; margin-top:10px; }
</style>
</head>
<body>
<div class="login-box">
<h2>Staff Login</h2>
<input type="text" id="userid" placeholder="Enter ID">
<input type="password" id="password" placeholder="Enter Password">
<button onclick="login()">Login</button>
<div id="error"></div>
</div>

<script>
const USER_SHEET = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQU4-KlIY732XZyhLAZB4-5pUrAcwiqO1bkhrVladSas6MT7ZK967vkNDPd_QzAu7rM72JnT5F5jDzL/pub?gid=32388154&single=true&output=csv";

// Register Service Worker
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('sw.js').then(()=>console.log("SW registered")).catch(err=>console.log(err));
}

function login(){
    const id   = document.getElementById("userid").value.trim();
    const pass = document.getElementById("password").value.trim();
    if(!id || !pass){ showError("Enter ID and Password"); return; }

    Papa.parse(USER_SHEET, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(res){
            const users = res.data.filter(u => u.ID && u.Password);
            let found = false;
            users.forEach(u => {
                const uID = (u.ID || "").trim();
                const uPass = (u.Password || "").trim();
                const uRole = (u.Role || "user").trim().toLowerCase();
                if(uID===id && uPass===pass){
                    found = true;
                    localStorage.setItem("userid", uID);
                    localStorage.setItem("name", (u.Name||"").trim());
                    localStorage.setItem("role", uRole);
                    location.href = (uRole==="admin"||uRole==="superadmin") ? "admin.html" : "dashboard.html";
                }
            });
            if(!found) showError("Wrong ID or Password");
        },
        error: function(err){ console.error(err); showError("Cannot load user database"); }
    });
}

function showError(msg){ document.getElementById("error").innerText = msg; }
</script>
</body>
</html>
