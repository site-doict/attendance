<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Attendance Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f2f4f7;
    padding:20px;
    text-align:center;
}
.header{
    max-width:1100px;
    margin:auto;
    background:white;
    padding:15px 25px;
    border-radius:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 2px 6px rgba(0,0,0,.1);
}
h2{ margin:0; color:#0056b3; }
.logout{
    padding:8px 16px;
    background:#dc3545;
    border:none;
    color:white;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
}
#loader{ margin:30px; font-size:18px; color:#555; }
.table-box{
    max-width:1100px;
    margin:auto;
    background:white;
    border-radius:10px;
    overflow-x:auto;
    box-shadow:0 4px 10px rgba(0,0,0,.1);
}
table{ width:100%; border-collapse:collapse; }
th,td{ border:1px solid #eee; padding:10px; font-size:14px; text-align:center; }
th{ background:#0056b3; color:white; }
.present{ background:#d4edda; color:#155724; font-weight:bold; }
.late{ background:#fff3cd; color:#856404; font-weight:bold; }
.absent{ background:#f8d7da; color:#721c24; font-weight:bold; }
</style>
</head>

<body>
<div class="header">
    <h2>Admin Attendance Summary</h2>
    <button class="logout" onclick="logout()">Logout</button>
</div>

<div id="loader">ðŸ”„ Loading Data...</div>

<div class="table-box">
<table>
<thead>
<tr>
    <th>Timestamp</th>
    <th>ID</th>
    <th>Name</th>
    <th>In Time</th>
    <th>Out Time</th>
    <th>Status</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQU4-KlIY732XZyhLAZB4-5pUrAcwiqO1bkhrVladSas6MT7ZK967vkNDPd_QzAu7rM72JnT5F5jDzL/pub?output=csv";
const PROXY = "https://api.allorigins.win/raw?url=";

if(localStorage.getItem("role") !== "admin" && localStorage.getItem("role") !== "superadmin"){
    location.href="index.html";
}

function loadData(){
    const url = PROXY + encodeURIComponent(CSV_URL);
    fetch(url)
    .then(res => res.text())
    .then(data => {
        Papa.parse(data, {
            header:true,
            skipEmptyLines:true,
            complete: function(result){
                renderTable(result.data);
            },
            error: function(err){
                document.getElementById("loader").innerText = "âŒ Failed to parse CSV";
                console.error(err);
            }
        });
    })
    .catch(err=>{
        document.getElementById("loader").innerText = "âŒ Failed to fetch data";
        console.error(err);
    });
}

function renderTable(rows){
    document.getElementById("loader").style.display="none";
    const tbody = document.getElementById("tbody");
    tbody.innerHTML="";

    if(!rows || rows.length===0){
        document.getElementById("loader").style.display="block";
        document.getElementById("loader").innerText="âš ï¸ No Data Found";
        return;
    }

    // Remove empty rows automatically
    rows = rows.filter(r => r.ID && r.ID.trim() !== "");

    rows.reverse().forEach(r=>{
        const ts = r.Timestamp || "---";
        const id = r.ID || "---";
        const name = r.Name || "---";
        const inTime = r.InTime || "---";
        const outTime = r.OutTime || "---";
        const status = (r.Status || "").trim();
        let cls = "absent";
        if(status === "Present") cls = "present";
        if(status === "Late") cls = "late";

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${ts}</td>
            <td>${id}</td>
            <td>${name}</td>
            <td>${inTime}</td>
            <td>${outTime}</td>
            <td class="${cls}">${status || "---"}</td>
        `;
        tbody.appendChild(tr);
    });
}

function logout(){
    localStorage.clear();
    location.href="index.html";
}

loadData();
</script>
</body>
</html>
